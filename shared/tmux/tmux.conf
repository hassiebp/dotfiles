########################################################################
# 1. Terminal & Input Settings
########################################################################

set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",*:Tc"

# Improve key handling
setw -g xterm-keys on
set -s escape-time 10                     # faster command sequences
set -sg repeat-time 600                   # increase repeat timeout
set -s focus-events on

########################################################################
# 2. General Behavior
########################################################################

# Start pane/window numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Rename windows automatically to reflect current program
setw -g automatic-rename on

# Renumber windows when one is closed
set -g renumber-windows on

# Set terminal title
set -g set-titles on

# Adjust display times
set -g display-panes-time 800    # pane indicators
set -g display-time 1000         # status messages
set -g status-interval 10        # redraw status line every 10s

# Increase history size
set -g history-limit 10000

# Start with mouse mode enabled (allows click to select window/pane, resize, etc.)
set -g mouse on

# Clear both screen and tmux history with Ctrl-l (no prefix)
bind -n C-l send-keys C-l \; run 'sleep 0.2' \; clear-history

# Monitor activity and disable visual bell
set -g monitor-activity on
set -g visual-activity off

# Use vim keybindings in copy mode
bind Enter copy-mode
bind-key -T copy-mode-vi y send-keys -X copy-pipe 'pbcopy'  # macOS
bind-key -T copy-mode-vi v send-keys -X begin-selection

########################################################################
# 3. Prefixes
########################################################################

# Second prefix: Ctrl-a (GNU Screen style)
unbind C-b
set -g prefix C-a

########################################################################
# 4. Session & Window Navigation
########################################################################

# Create a new session
bind C-c new-session

# Find a session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# Switch to last session
bind BTab switch-client -l

# Window navigation
# (unbinding the default n/p to avoid confusion with next/previous pane)
unbind n
unbind p

bind -r C-h previous-window   # select previous window
bind -r C-l next-window       # select next window
bind Tab last-window          # move to last active window

########################################################################
# 5. Splits & Pane Management
########################################################################

# Splits
bind - split-window -v    # split horizontally
bind _ split-window -h    # split vertically
bind-key | split-window -h

# Pane navigation (vim-style)
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R
bind > swap-pane -D
bind < swap-pane -U

# Maximize current pane (depends on your _maximize_pane script)
bind + resize-pane -Z   # toggle zoom

# Pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

########################################################################
# 6. FZF Session Management
########################################################################

# Session switcher with fzf (excludes current session)
bind s display-popup -E "tmux list-sessions -F '#S' | \
    grep -v '^#{session_name}$' | \
    fzf --height=40% --reverse --border --prompt='Switch to session: ' | \
    xargs tmux switch-client -t"

# Session manager with project creation and kill option
# To customize project directories, add them to ~/.tmux-projects.conf
# Example: export TMUX_PROJECT_DIRS="~/projects ~/work ~/dev"
bind S run-shell 'tmux display-popup -E "
if [ -f ~/.tmux-projects.conf ]; then
  source ~/.tmux-projects.conf
fi
PROJECT_DIRS=\${TMUX_PROJECT_DIRS:-\"~\"}

session=\$(
  {
    tmux list-sessions -F \"#S\" 2>/dev/null
    find \$PROJECT_DIRS -maxdepth 3 -type d -name .git 2>/dev/null |
    sed \"s|/.git||\" |
    xargs -I {} basename {} |
    while read project; do
      if ! tmux has-session -t \"\$project\" 2>/dev/null; then
        echo \"\$project\"
      fi
    done
  } | sort -u | fzf --height=40% --reverse --border --prompt=\"Session: \" --header=\"Enter=switch/create, Ctrl-X=kill\" --bind=\"ctrl-x:execute(tmux kill-session -t {} 2>/dev/null || true)+reload({
    tmux list-sessions -F \\\"#S\\\" 2>/dev/null
    find \$PROJECT_DIRS -maxdepth 3 -type d -name .git 2>/dev/null |
    sed \\\"s|/.git||\\\" |
    xargs -I {} basename {} |
    while read project; do
      if ! tmux has-session -t \\\"\\\$project\\\" 2>/dev/null; then
        echo \\\"\\\$project\\\"
      fi
    done
  } | sort -u)\"
)
if [ -n \"\$session\" ]; then
  if tmux has-session -t \"\$session\" 2>/dev/null; then
    tmux switch-client -t \"\$session\"
  else
    project_path=\$(find \$PROJECT_DIRS -maxdepth 3 -name \"\$session\" -type d 2>/dev/null | head -1)
    if [ -n \"\$project_path\" ]; then
      tmux new-session -d -s \"\$session\" -c \"\$project_path\"
    else
      tmux new-session -d -s \"\$session\"
    fi
    tmux switch-client -t \"\$session\"
  fi
fi
"'

########################################################################
# 7. Mouse Toggle (if you want to disable/re-enable on the fly)
########################################################################

bind m run "cut -c3- '#{TMUX_CONF}' | sh -s _toggle_mouse"

########################################################################
# 8. Additional tmux.conf Options (from your config)
########################################################################

# If you are using oh-my-tmux or a similar framework, these might be relevant
tmux_conf_preserve_stock_bindings=false
tmux_conf_new_session_prompt=false
tmux_conf_new_window_retain_current_path=true
tmux_conf_new_window_reconnect_ssh=false
tmux_conf_new_pane_retain_current_path=true
tmux_conf_new_pane_reconnect_ssh=false

tmux_conf_24b_colour=auto
tmux_conf_theme=disabled
tmux_conf_copy_to_os_clipboard=true
tmux_conf_urlscan_options="--compact --dedupe"

########################################################################
# 9. Status Line & Visual Tweaks
########################################################################

# https://github.com/niksingh710/minimal-tmux-status
set -g @minimal-tmux-use-arrow true
set -g @minimal-tmux-right-arrow ""
set -g @minimal-tmux-left-arrow ""
set -g @minimal-tmux-indicator-str "#S"
set -g @minimal-tmux-status-right-extra "%Y-%m-%d %H:%M "
set -g @minimal-tmux-right false
set -g status-left-length 100

set -g message-style 'bg=white,fg=black'
set -g message-command-style 'bg=white,fg=black'
set -g mode-style 'bg=#fff9c4,fg=#000000' # visual selection color

########################################################################
# TMUX Plugin manager (must be end of file)
########################################################################
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'niksingh710/minimal-tmux-status'
set -g @plugin 'tmux-plugins/tmux-yank'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

########################################################################
# End of file
########################################################################
